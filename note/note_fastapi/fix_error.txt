D∆∞·ªõi ƒë√¢y l√† **t·ªïng h·ª£p t·∫•t c·∫£ l·ªói b·∫°n ƒë√£ g·∫∑p t·ª´ ƒë·∫ßu ƒë·∫øn gi·ªù**, k√®m c√°ch fix chi ti·∫øt v√† k·∫øt qu·∫£ sau khi fix.  

---

# **üìå T·ªîNG H·ª¢P L·ªñI V√Ä C√ÅCH FIX**
D∆∞·ªõi ƒë√¢y l√† danh s√°ch c√°c l·ªói theo th·ª© t·ª± th·ªùi gian t·ª´ l√∫c b·∫Øt ƒë·∫ßu tri·ªÉn khai Triton Inference Server.  

---

## **1Ô∏è‚É£ L·ªói kh√¥ng t√¨m th·∫•y module FastAPI khi ch·∫°y server**  
### **L·ªánh ch·∫°y:**  
```powershell
uvicorn main:app --reload
```
### **K·∫øt qu·∫£ l·ªói:**  
```plaintext
ModuleNotFoundError: No module named 'fastapi'
```

### **Nguy√™n nh√¢n:**  
- FastAPI ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t trong m√¥i tr∆∞·ªùng hi·ªán t·∫°i.  

### **C√°ch fix:**  
- C√†i ƒë·∫∑t FastAPI v√† c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt:  
```powershell
pip install fastapi uvicorn requests numpy
```

### **K·∫øt qu·∫£ sau khi fix:**  
‚úÖ Server ch·∫°y th√†nh c√¥ng.  

---

## **2Ô∏è‚É£ L·ªói kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Triton Server**  
### **L·ªánh ch·∫°y:**  
```powershell
python test_predict.py
```
### **K·∫øt qu·∫£ l·ªói:**  
```plaintext
requests.exceptions.ConnectionError: Failed to establish a new connection: [Errno 111] Connection refused
```

### **Nguy√™n nh√¢n:**  
- Triton Server ch∆∞a ƒë∆∞·ª£c kh·ªüi ƒë·ªông.  
- Sai ƒë·ªãa ch·ªâ ho·∫∑c c·ªïng k·∫øt n·ªëi.  

### **C√°ch fix:**  
- Ch·∫°y Triton Server tr∆∞·ªõc:  
```powershell
docker run --rm --gpus=all -p 8000:8000 -p 8001:8001 -p 8002:8002 -v D:\models:/models nvcr.io/nvidia/tritonserver:23.12-py3 tritonserver --model-repository=/models
```
- Ki·ªÉm tra k·∫øt n·ªëi b·∫±ng l·ªánh:  
```powershell
curl http://localhost:8000/v2/health/ready
```
(N·∫øu tr·∫£ v·ªÅ `"true"` nghƒ©a l√† Triton ƒë√£ ch·∫°y th√†nh c√¥ng).  

### **K·∫øt qu·∫£ sau khi fix:**  
‚úÖ K·∫øt n·ªëi th√†nh c√¥ng v·ªõi Triton Server.  

---

## **3Ô∏è‚É£ L·ªói `NameError: name 'response' is not defined`**
### **L·ªánh ch·∫°y:**  
```powershell
python test_predict.py
```
### **K·∫øt qu·∫£ l·ªói:**  
```plaintext
Traceback (most recent call last):
  File "D:\SourceCode\ProjectOJT\FastAPI\test_predict.py", line 3, in <module>
    output_data = response["outputs"][0]["data"]
                  ^^^^^^^^
NameError: name 'response' is not defined
```

### **Nguy√™n nh√¢n:**  
- Bi·∫øn `response` ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o.  
- Request b·ªã l·ªói nh∆∞ng kh√¥ng c√≥ ki·ªÉm tra l·ªói.  

### **C√°ch fix:**  
- Ki·ªÉm tra status code tr∆∞·ªõc khi l·∫•y d·ªØ li·ªáu t·ª´ `response`:  
```python
import requests

url = "http://localhost:8000/v2/models/densenet_onnx/infer"
data = {"inputs": [{"name": "data_0", "shape": [3, 224, 224], "datatype": "FP32", "data": [0.5] * (3 * 224 * 224)}]}

response = requests.post(url, json=data)

if response.status_code == 200:
    response_json = response.json()
    print("Response:", response_json)
    output_data = response_json["outputs"][0]["data"]
else:
    print(f"Request failed with status code {response.status_code}")
    print("Response:", response.text)
```

### **K·∫øt qu·∫£ sau khi fix:**  
‚úÖ Kh√¥ng c√≤n l·ªói `NameError`, request ƒë∆∞·ª£c ki·ªÉm tra tr∆∞·ªõc khi truy xu·∫•t d·ªØ li·ªáu.  

---

## **4Ô∏è‚É£ L·ªói HTTP 400: `unexpected shape for input`**
### **L·ªánh ch·∫°y:**  
```powershell
python test_predict.py
```
### **K·∫øt qu·∫£ l·ªói:**  
```json
{"error":"unexpected shape for input 'data_0' for model 'densenet_onnx'. Expected [3,224,224], got [1,3,224,224]."}
```

### **Nguy√™n nh√¢n:**  
- Input c√≥ batch size `[1,3,224,224]` nh∆∞ng model y√™u c·∫ßu `[3,224,224]`.  

### **C√°ch fix:**  
- Xo√° batch dimension khi g·ª≠i request:  
```python
import numpy as np

image = np.random.rand(3, 224, 224).astype(np.float32).tolist()

data = {
    "inputs": [
        {
            "name": "data_0",
            "shape": [3, 224, 224],  # ƒê√∫ng shape model y√™u c·∫ßu
            "datatype": "FP32",
            "data": image
        }
    ]
}
```

### **K·∫øt qu·∫£ sau khi fix:**  
‚úÖ Kh√¥ng c√≤n l·ªói v·ªÅ shape, m√¥ h√¨nh nh·∫≠n ƒë√∫ng input.  

---

## **5Ô∏è‚É£ L·ªói kh√¥ng t√¨m th·∫•y m√¥ h√¨nh khi g·ª≠i request**
### **L·ªánh ch·∫°y:**  
```powershell
python test_predict.py
```
### **K·∫øt qu·∫£ l·ªói:**  
```json
{"error":"Request for unknown model: 'densenet_onnx'"}
```

### **Nguy√™n nh√¢n:**  
- Model ch∆∞a ƒë∆∞·ª£c load v√†o Triton Server.  
- Sai t√™n model trong request.  

### **C√°ch fix:**  
- Ki·ªÉm tra model ƒë√£ ƒë∆∞·ª£c Triton load ch∆∞a:  
```powershell
curl http://localhost:8000/v2/models/densenet_onnx
```
- N·∫øu ch∆∞a c√≥, ki·ªÉm tra th∆∞ m·ª•c model repository (`/models/densenet_onnx`).  
- N·∫øu model t√™n kh√°c (`densenet` thay v√¨ `densenet_onnx`), s·ª≠a l·∫°i trong request:  
```python
url = "http://localhost:8000/v2/models/densenet/infer"
```

### **K·∫øt qu·∫£ sau khi fix:**  
‚úÖ Triton nh·∫≠n di·ªán ƒë√∫ng m√¥ h√¨nh v√† th·ª±c hi·ªán inference.  

---

## **6Ô∏è‚É£ Ch·∫°y inference th√†nh c√¥ng**
### **L·ªánh ch·∫°y:**  
```powershell
python test_predict.py
```
### **K·∫øt qu·∫£:**  
```plaintext
Predicted class: 591
```
‚úÖ M√¥ h√¨nh ƒë√£ ch·∫°y ƒë√∫ng, inference th√†nh c√¥ng.  

---

# **üìå T√ìM T·∫ÆT C√ÅC L·ªñI V√Ä C√ÅCH FIX**
| **#**  | **L·ªói**                                          | **Nguy√™n nh√¢n**                                      | **C√°ch fix** |
|----|------------------------------------------------|------------------------------------------------|------------|
| 1  | `ModuleNotFoundError: No module named 'fastapi'` | Ch∆∞a c√†i FastAPI | `pip install fastapi uvicorn requests numpy` |
| 2  | `ConnectionError: Failed to establish a new connection` | Triton Server ch∆∞a ch·∫°y | Ch·∫°y Triton Server b·∫±ng Docker |
| 3  | `NameError: name 'response' is not defined` | Bi·∫øn `response` ch∆∞a kh·ªüi t·∫°o ho·∫∑c request l·ªói | Ki·ªÉm tra response tr∆∞·ªõc khi truy xu·∫•t d·ªØ li·ªáu |
| 4  | HTTP 400: `unexpected shape for input` | G·ª≠i input c√≥ batch size `[1,3,224,224]` thay v√¨ `[3,224,224]` | Xo√° batch dimension |
| 5  | `Request for unknown model` | Model ch∆∞a ƒë∆∞·ª£c load v√†o Triton ho·∫∑c sai t√™n | Ki·ªÉm tra model repository v√† t√™n model |
| 6  | ‚úÖ **Inference th√†nh c√¥ng** | M√¥ h√¨nh ƒë√£ ch·∫°y ƒë√∫ng | Kh√¥ng c·∫ßn fix |

üî• **K·∫øt lu·∫≠n:** B·∫°n ƒë√£ tri·ªÉn khai th√†nh c√¥ng Triton Inference Server v√† ch·∫°y inference ƒë√∫ng! üöÄ